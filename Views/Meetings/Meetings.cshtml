@model IEnumerable<MyField.Models.Meeting>

@{
    ViewData["Title"] = "Meetings";
    Layout = "~/Views/Shared/_PagesLayout.cshtml";
}

<br />
@await Html.PartialAsync("_HomeButton")
<h4 style="text-align:center;">Meetings</h4>
<br />
@if(Model.Any())
{
    <div class="create-button">
        <a href="@Url.Action("Create")" class="btn btn-outline-primary btn-create" style="white-space: nowrap;">
            <i class="fas fa-plus"></i> Create new
        </a>
    </div>
    <br />
    <div class="table-responsive">
        <table class="table table-striped table-borderless">
            <thead>
                <tr style="color:white;background-color: #324260; white-space: nowrap;">
                    <th>
                        Title
                    </th>
                    <th>
                        Venue
                    </th>
                    <th>
                        Date
                    </th>
                    <th>
                        Time
                    </th>
                    <th>
                        Actions
                    </th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in Model)
                {

                    var dropdownId = "dropdownMenuButton" + item.MeetingId;
                    <tr class="ellipsis">
                        <td>
                            @Html.DisplayFor(modelItem => item.MeetingTitle)
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.Venue)
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.MeetingDate)
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.MeetingTime)
                        </td>
                        <td style="white-space: nowrap;">
                            <div class="club-btn-group">
                                <button type="button" class="btn btn-primary btn-sm dropdown-toggle" id="@dropdownId">
                                    Actions
                                </button>
                                <div class="dropdown-menu" aria-labelledby="@dropdownId">
                                    <a class="dropdown-item" href="@Url.Action("RejoinSeason", "Clubs", new { clubId = item.MeetingId })">
                                        <i class="fas fa-sign-in-alt" style="color: #28a745;"></i> Rejoin
                                    </a>
                                    <a class="dropdown-item" href="@Url.Action("Edit", "Clubs", new { id = item.MeetingId })">
                                        <i class="fas fa-pen" style="color: blue;"></i> Update
                                    </a>
                                    <a class="dropdown-item" href="@Url.Action("SuspendClub", "Clubs", new { id = item.MeetingId })">
                                        <i class="fas fa-ban" style="color: #dc3545;"></i> Suspend
                                    </a>
                                    <a class="dropdown-item" href="@Url.Action("UnsuspendClub", "Clubs", new { id = item.MeetingId })">
                                        <i class="fas fa-check-circle" style="color: #ffc107;"></i> Unsuspend
                                    </a>
                                    <a class="dropdown-item" href="@Url.Action("Delete", "Clubs", new { id = item.MeetingId })" onclick="return confirm('Are you sure you want to delete this item?');">
                                        <i class="fas fa-trash" style="color: red;"></i> Delete
                                    </a>
                                </div>
                            </div>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
}
else
{
    <div class="d-flex justify-content-center align-items-center" style="height: 60vh; flex-direction: column;">
        <p class="text-center">There are no meetings yet.</p>
        <div class="create-button">
            <a href="@Url.Action("Create")" class="btn btn-outline-primary btn-create" style="white-space: nowrap;">
                <i class="fas fa-plus"></i> Create new
            </a>
        </div>
    </div>
}


<script>
    $(document).on('click', '.dropdown-toggle', function (event) {
        event.stopPropagation();
        var $this = $(this);
        $('.dropdown-menu').not($this.next('.dropdown-menu')).removeClass('show');
        var $menu = $this.next('.dropdown-menu');
        $menu.toggleClass('show');

        // Adjust dropdown position
        var offset = $this.offset();
        var menuHeight = $menu.outerHeight();
        var windowHeight = $(window).height();
        var scrollTop = $(window).scrollTop();
        var tableOffset = $this.closest('table').offset();
        var tableHeight = $this.closest('table').outerHeight();
        var availableSpaceBelow = windowHeight - (offset.top - scrollTop) - tableHeight;
        var availableSpaceAbove = offset.top - tableOffset.top;

        if (availableSpaceBelow < menuHeight && availableSpaceAbove > menuHeight) {
            $menu.css('top', 'auto');
            $menu.css('bottom', '100%');
        } else {
            $menu.css('top', '100%');
            $menu.css('bottom', 'auto');
        }
    });

    $(document).on('click', function (event) {
        var $target = $(event.target);
        if (!$target.closest('.dropdown-menu').length && !$target.closest('.dropdown-toggle').length) {
            $('.dropdown-menu').removeClass('show');
        }
    });

    setTimeout(function () {
        document.getElementById("tempDataMessage").style.display = "none";
    }, 3000);
</script>
